(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{9093:function(t,e,s){Promise.resolve().then(s.bind(s,6057))},6057:function(t,e,s){"use strict";let r;s.r(e),s.d(e,{default:function(){return k}});var i=s(6684),n=s(8469),a=s(4921),u=s(2006),h=s(9982),c=s(1602),l=s(9004),o=class extends c.l{constructor(t,e){super(),this.options=e,this.#t=t,this.#e=null,this.bindMethods(),this.setOptions(e)}#t;#s=void 0;#r=void 0;#i=void 0;#n;#a;#e;#u;#h;#c;#l;#o;#d;#p=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){1===this.listeners.size&&(this.#s.addObserver(this),d(this.#s,this.options)?this.#f():this.updateResult(),this.#y())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return p(this.#s,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return p(this.#s,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#R(),this.#v(),this.#s.removeObserver(this)}setOptions(t,e){let s=this.options,r=this.#s;if(this.options=this.#t.defaultQueryOptions(t),void 0!==this.options.enabled&&"boolean"!=typeof this.options.enabled)throw Error("Expected enabled to be a boolean");this.#b(),this.#s.setOptions(this.options),s._defaulted&&!(0,a.VS)(this.options,s)&&this.#t.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#s,observer:this});let i=this.hasListeners();i&&f(this.#s,r,this.options,s)&&this.#f(),this.updateResult(e),i&&(this.#s!==r||this.options.enabled!==s.enabled||this.options.staleTime!==s.staleTime)&&this.#m();let n=this.#Q();i&&(this.#s!==r||this.options.enabled!==s.enabled||n!==this.#d)&&this.#g(n)}getOptimisticResult(t){let e=this.#t.getQueryCache().build(this.#t,t),s=this.createResult(e,t);return(0,a.VS)(this.getCurrentResult(),s)||(this.#i=s,this.#a=this.options,this.#n=this.#s.state),s}getCurrentResult(){return this.#i}trackResult(t,e){let s={};return Object.keys(t).forEach(r=>{Object.defineProperty(s,r,{configurable:!1,enumerable:!0,get:()=>(this.trackProp(r),e?.(r),t[r])})}),s}trackProp(t){this.#p.add(t)}getCurrentQuery(){return this.#s}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){let e=this.#t.defaultQueryOptions(t),s=this.#t.getQueryCache().build(this.#t,e);return s.isFetchingOptimistic=!0,s.fetch().then(()=>this.createResult(s,e))}fetch(t){return this.#f({...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#i))}#f(t){this.#b();let e=this.#s.fetch(this.options,t);return t?.throwOnError||(e=e.catch(a.ZT)),e}#m(){if(this.#R(),a.sk||this.#i.isStale||!(0,a.PN)(this.options.staleTime))return;let t=(0,a.Kp)(this.#i.dataUpdatedAt,this.options.staleTime);this.#l=setTimeout(()=>{this.#i.isStale||this.updateResult()},t+1)}#Q(){return("function"==typeof this.options.refetchInterval?this.options.refetchInterval(this.#s):this.options.refetchInterval)??!1}#g(t){this.#v(),this.#d=t,!a.sk&&!1!==this.options.enabled&&(0,a.PN)(this.#d)&&0!==this.#d&&(this.#o=setInterval(()=>{(this.options.refetchIntervalInBackground||h.j.isFocused())&&this.#f()},this.#d))}#y(){this.#m(),this.#g(this.#Q())}#R(){this.#l&&(clearTimeout(this.#l),this.#l=void 0)}#v(){this.#o&&(clearInterval(this.#o),this.#o=void 0)}createResult(t,e){let s;let r=this.#s,i=this.options,n=this.#i,u=this.#n,h=this.#a,c=t!==r?t.state:this.#r,{state:o}=t,p={...o},R=!1;if(e._optimisticResults){let s=this.hasListeners(),n=!s&&d(t,e),a=s&&f(t,r,e,i);(n||a)&&(p={...p,...(0,l.z)(o.data,t.options)}),"isRestoring"===e._optimisticResults&&(p.fetchStatus="idle")}let{error:v,errorUpdatedAt:b,status:m}=p;if(e.select&&void 0!==p.data){if(n&&p.data===u?.data&&e.select===this.#u)s=this.#h;else try{this.#u=e.select,s=e.select(p.data),s=(0,a.oE)(n?.data,s,e),this.#h=s,this.#e=null}catch(t){this.#e=t}}else s=p.data;if(void 0!==e.placeholderData&&void 0===s&&"pending"===m){let t;if(n?.isPlaceholderData&&e.placeholderData===h?.placeholderData)t=n.data;else if(t="function"==typeof e.placeholderData?e.placeholderData(this.#c?.state.data,this.#c):e.placeholderData,e.select&&void 0!==t)try{t=e.select(t),this.#e=null}catch(t){this.#e=t}void 0!==t&&(m="success",s=(0,a.oE)(n?.data,t,e),R=!0)}this.#e&&(v=this.#e,s=this.#h,b=Date.now(),m="error");let Q="fetching"===p.fetchStatus,g="pending"===m,O="error"===m,S=g&&Q,I=void 0!==s;return{status:m,fetchStatus:p.fetchStatus,isPending:g,isSuccess:"success"===m,isError:O,isInitialLoading:S,isLoading:S,data:s,dataUpdatedAt:p.dataUpdatedAt,error:v,errorUpdatedAt:b,failureCount:p.fetchFailureCount,failureReason:p.fetchFailureReason,errorUpdateCount:p.errorUpdateCount,isFetched:p.dataUpdateCount>0||p.errorUpdateCount>0,isFetchedAfterMount:p.dataUpdateCount>c.dataUpdateCount||p.errorUpdateCount>c.errorUpdateCount,isFetching:Q,isRefetching:Q&&!g,isLoadingError:O&&!I,isPaused:"paused"===p.fetchStatus,isPlaceholderData:R,isRefetchError:O&&I,isStale:y(t,e),refetch:this.refetch}}updateResult(t){let e=this.#i,s=this.createResult(this.#s,this.options);if(this.#n=this.#s.state,this.#a=this.options,void 0!==this.#n.data&&(this.#c=this.#s),(0,a.VS)(s,e))return;this.#i=s;let r={};t?.listeners!==!1&&(()=>{if(!e)return!0;let{notifyOnChangeProps:t}=this.options,s="function"==typeof t?t():t;if("all"===s||!s&&!this.#p.size)return!0;let r=new Set(s??this.#p);return this.options.throwOnError&&r.add("error"),Object.keys(this.#i).some(t=>this.#i[t]!==e[t]&&r.has(t))})()&&(r.listeners=!0),this.#O({...r,...t})}#b(){let t=this.#t.getQueryCache().build(this.#t,this.options);if(t===this.#s)return;let e=this.#s;this.#s=t,this.#r=t.state,this.hasListeners()&&(e?.removeObserver(this),t.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#y()}#O(t){u.V.batch(()=>{t.listeners&&this.listeners.forEach(t=>{t(this.#i)}),this.#t.getQueryCache().notify({query:this.#s,type:"observerResultsUpdated"})})}};function d(t,e){return!1!==e.enabled&&void 0===t.state.data&&!("error"===t.state.status&&!1===e.retryOnMount)||void 0!==t.state.data&&p(t,e,e.refetchOnMount)}function p(t,e,s){if(!1!==e.enabled){let r="function"==typeof s?s(t):s;return"always"===r||!1!==r&&y(t,e)}return!1}function f(t,e,s,r){return(t!==e||!1===r.enabled)&&(!s.suspense||"error"!==t.state.status)&&y(t,s)}function y(t,e){return!1!==e.enabled&&t.isStaleByTime(e.staleTime)}var R=s(8001),v=R.createContext((r=!1,{clearReset:()=>{r=!1},reset:()=>{r=!0},isReset:()=>r})),b=()=>R.useContext(v),m=s(5435),Q=R.createContext(!1),g=()=>R.useContext(Q);Q.Provider;var O=(t,e)=>{(t.suspense||t.throwOnError)&&!e.isReset()&&(t.retryOnMount=!1)},S=t=>{R.useEffect(()=>{t.clearReset()},[t])},I=t=>{var e;let{result:s,errorResetBoundary:r,throwOnError:i,query:n}=t;return s.isError&&!r.isReset()&&!s.isFetching&&n&&(e=[s.error,n],"function"==typeof i?i(...e):!!i)},C=t=>{t.suspense&&"number"!=typeof t.staleTime&&(t.staleTime=1e3)},x=(t,e)=>t?.suspense&&e.isPending,E=(t,e,s)=>e.fetchOptimistic(t).catch(()=>{s.clearReset()});function j(t,e){return function(t,e,s){let r=(0,m.NL)(s),i=g(),n=b(),a=r.defaultQueryOptions(t);a._optimisticResults=i?"isRestoring":"optimistic",C(a),O(a,n),S(n);let[h]=R.useState(()=>new e(r,a)),c=h.getOptimisticResult(a);if(R.useSyncExternalStore(R.useCallback(t=>{let e=i?()=>void 0:h.subscribe(u.V.batchCalls(t));return h.updateResult(),e},[h,i]),()=>h.getCurrentResult(),()=>h.getCurrentResult()),R.useEffect(()=>{h.setOptions(a,{listeners:!1})},[a,h]),x(a,c))throw E(a,h,n);if(I({result:c,errorResetBoundary:n,throwOnError:a.throwOnError,query:r.getQueryCache().get(a.queryHash)}))throw c.error;return a.notifyOnChangeProps?c:h.trackResult(c)}(t,o,e)}function w(t){let{value:e,onChange:s,options:r}=t;return(0,i.jsxs)(n.Ph.Root,{value:e,onValueChange:s,children:[(0,i.jsx)(n.Ph.Trigger,{style:{width:"100%"},placeholder:"Select a table"}),(0,i.jsx)(n.Ph.Content,{children:null==r?void 0:r.map(t=>(0,i.jsx)(n.Ph.Item,{value:t,children:t},t))})]})}function T(t){let{table:e,setQuery:s,tablesLoading:r}=t,[a,u]=(0,R.useState)("");return(0,R.useEffect)(()=>{if(e){let t="SELECT * FROM '".concat(e,"' LIMIT 30");s(t),u(t)}},[e,r]),(0,i.jsx)("form",{onSubmit:t=>{t.preventDefault(),s(a)},children:(0,i.jsxs)(n.kC,{direction:"row",gap:"2",children:[(0,i.jsx)(n.nv.Root,{style:{flex:"1"},placeholder:"SQL queryâ€¦",value:a,onChange:t=>u(t.target.value),children:(0,i.jsx)(n.nv.Slot,{})}),(0,i.jsx)(n.zx,{type:"submit",children:"Execute query"})]})})}function F(t){let{table:e,query:s}=t,{data:r}=j({queryKey:["schema",{table:e}],queryFn:async()=>(await fetch("/api/schema?table=".concat(e))).json(),select:t=>t.schema}),{data:a}=j({queryKey:["rows",{query:s}],queryFn:async()=>(await fetch("/api/rows?query=".concat(s))).json(),select:t=>t.rows.map(t=>Object.fromEntries(Object.entries(t).map(t=>{let[e,s]=t;return(null==s?void 0:s.type)==="Buffer"?[e,BigInt("0x"+(null==s?void 0:s.data).map(t=>t.toString(16).padStart(2,"0")).join("")).toString()]:[e,s]}))),enabled:!!e&&!!s,refetchInterval:1e3});return(0,i.jsxs)(n.iA.fC,{children:[(0,i.jsx)(n.iA.h4,{children:(0,i.jsx)(n.iA.X2,{children:null==r?void 0:r.map(t=>(0,i.jsxs)(n.iA.Ni,{children:[t.name," (",t.type,")"]},t.name))})}),(0,i.jsx)(n.iA.uT,{children:null==a?void 0:a.map((t,e)=>(0,i.jsx)(n.iA.X2,{children:null==r?void 0:r.map(e=>(0,i.jsx)(n.iA.bL,{children:t[e.name]},e.name))},e))})]})}function k(){let[t,e]=(0,R.useState)(),[s,r]=(0,R.useState)(),{data:a,isLoading:u}=j({queryKey:["tables"],queryFn:async()=>(await fetch("/api/tables")).json(),select:t=>t.tables.map(t=>t.name),refetchInterval:15e3});return(0,R.useEffect)(()=>{!t&&a&&e(a[0])},[t,a]),(0,i.jsx)(n.W2,{children:(0,i.jsxs)(n.kC,{direction:"column",gap:"2",children:[(0,i.jsx)(w,{value:t,onChange:e,options:a}),(0,i.jsx)(T,{table:t,tablesLoading:u,setQuery:r}),(0,i.jsx)(F,{table:t,query:s})]})})}}},function(t){t.O(0,[524,814,793,744],function(){return t(t.s=9093)}),_N_E=t.O()}]);