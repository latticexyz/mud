import { CollapseCode } from "../../../components/CollapseCode";
import { Callout } from "nextra/components";

# ERC 721 (NFT) module

<Callout type="warning" emoji="⚠️">

This module is unaudited and may change in the future.

</Callout>

The [`erc721-puppet`](https://github.com/latticexyz/mud/tree/main/packages/world-modules/src/modules/erc721-puppet) module lets you create [ERC-721](https://ethereum.org/en/developers/docs/standards/tokens/erc-721/) NFTs as part of a MUD `World`.
The advantage of doing this, rather than creating a separate [NFT contract](https://github.com/OpenZeppelin/openzeppelin-contracts/tree/master/contracts/token/ERC721) and merely controlling it from MUD, is that all the information is in MUD tables and is immediately available in the client.

## Deployment

To deploy this module you use a Solidity script.
To use the one here, first edit `.env` to make sure we have these environment variables.

| Variable       | Explanation                                                   | Sample Value                                                       |
| -------------- | ------------------------------------------------------------- | ------------------------------------------------------------------ |
| PRIVATE_KEY    | The private key for an address that has ETH on the blockchain | 0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80 |
| WORLD_ADDRESS  | The address of the `World` that gets the NFT                  | 0x8d8b6b8414e1e3dcfd4168561b9be6bd3bf6ec4b                         |
| NFT_NAMESPACE  | Namespace for the NFT tables and `System`s                    | DDDD<sup>1</sup>                                                   |
| TOKEN_NAME     | The name of the token                                         | "No features or traits"<sup>2</sup>                                |
| TOKEN_SYMBOL   | The symbol of the token                                       | NFT                                                                |
| TOKEN_BASE_URI | The base URI for the token                                    | http://example.com/                                                |

(1) The reason to use `DDDD` is that in ASCII it is 0x44444444, which makes debugging easier.
Of course, not a production system you'd use a meaningful name.

(2) Values that include white spaces need to be enclosed by quotes.

Then, run this script:

```solidity
// SPDX-License-Identifier: MIT
pragma solidity >=0.8.24;

import { Script } from "forge-std/Script.sol";
import { console } from "forge-std/console.sol";
import { StoreSwitch } from "@latticexyz/store/src/StoreSwitch.sol";

import { WorldResourceIdLib } from "@latticexyz/world/src/WorldResourceId.sol";
import { ResourceId } from "@latticexyz/store/src/ResourceId.sol";
import { ERC721Module } from "@latticexyz/world-modules/src/modules/erc721-puppet/ERC721Module.sol";
import { ERC721MetadataData } from "@latticexyz/world-modules/src/modules/erc721-puppet/tables/ERC721Metadata.sol";
import { registerERC721 } from "@latticexyz/world-modules/src/modules/erc721-puppet/registerERC721.sol";
import { IERC721Mintable } from "@latticexyz/world-modules/src/modules/erc721-puppet/IERC721Mintable.sol";

import { IWorld } from "../src/codegen/world/IWorld.sol";

contract PostDeploy is Script {
  function run() external {
    // Load the environment
    uint256 deployerPrivateKey = vm.envUint("PRIVATE_KEY");
    address worldAddress = vm.envAddress("WORLD_ADDRESS");
    string memory nftNamespace = vm.envString("NFT_NAMESPACE");
    ERC721MetadataData memory metadata;
    metadata.name = vm.envString("TOKEN_NAME");
    metadata.symbol = vm.envString("TOKEN_SYMBOL");
    metadata.baseURI = vm.envString("TOKEN_BASE_URI");

    // Specify a store so that you can use tables directly
    IWorld world = IWorld(worldAddress);
    StoreSwitch.setStoreAddress(worldAddress);

    // Start broadcasting transactions from the deployer account
    vm.startBroadcast(deployerPrivateKey);

    IERC721Mintable seasonPass = registerERC721(
      world,
      bytes14(bytes("DDDD")),
      ERC721MetadataData({
        name: "Token",
        symbol: "ffff",
        baseURI: "https://skystrife-metadata.latticexyz.workers.dev/metadata/1/"
      })
    );

    /*
    // Create namespace for the token
    bytes14 namespace14 = bytes14(bytes(nftNamespace));

    IERC721Mintable token = registerERC721(world, 
	namespace14, 
	metadata
    );
    console.log(address(token));
*/

    /*
    // Deploy the module's contract
    ERC721Module nftModule = new ERC721Module();
    console.log("Module deployed at address:", address(nftModule));

    // Install the new module on the World
    console.log("Before world.installModule");
    world.installModule(nftModule, abi.encode(namespace14, metadata));
    console.log("Module installed");
*/

    vm.stopBroadcast();
  }
}
```

```sh
forge script --rpc-url http://localhost:8545  script/DeployNFT.s.sol --broadcast
```
