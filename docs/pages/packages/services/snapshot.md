<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# snapshot

```go
import "command-line-arguments"
```

## Index

- [Constants](#constants)
- [func ChunkRawStateSnapshot(rawStateSnapshot *pb.ECSStateSnapshot, chunkPercentage int) []*pb.ECSStateSnapshot](#func-chunkrawstatesnapshot)
- [func IsSnaphotAvailableLatest(worldAddress string) bool](#func-issnaphotavailablelatest)
- [func IsWorldAddressSnapshotAvailable() bool](#func-isworldaddresssnapshotavailable)
- [func PruneSnapshotOwnedByComponent(snapshot *pb.ECSStateSnapshot, pruneForAddress string) *pb.ECSStateSnapshot](#func-prunesnapshotownedbycomponent)
- [func RawReadStateSnapshotLatest(worldAddress string) \*pb.ECSStateSnapshot](#func-rawreadstatesnapshotlatest)
- [func RawReadWorldAddressesSnapshot() \*pb.Worlds](#func-rawreadworldaddressessnapshot)
- [func Start(state ChainECSState, client *ethclient.Client, startBlock *big.Int, worldAddresses []common.Address, config *SnapshotServerConfig, logger *zap.Logger)](#func-start)
- [type ChainECSState](#type-chainecsstate)
  - [func Sync(client *ethclient.Client, fromBlock *big.Int, toBlock *big.Int, worldAddresses []common.Address, config *SnapshotServerConfig) ChainECSState](#func-sync)
- [type ECSState](#type-ecsstate)
  - [func SnapshotToState(stateSnapshot \*pb.ECSStateSnapshot) ECSState](#func-snapshottostate)
- [type SnapshotServerConfig](#type-snapshotserverconfig)
- [type SnapshotType](#type-snapshottype)

## Constants

SerializedStateFilename is the name for the snapshot binary of ECS State.

```go
const SerializedStateFilename string = "./snapshots/SerializedECSState"
```

SerializedWorldsFilename is the name for the snapshot binary of Worlds.

```go
const SerializedWorldsFilename string = "./snapshots/SerializedWorlds"
```

SnapshotDir is the directory name for where the ECS snapshots are stored.

```go
const SnapshotDir string = "snapshots"
```

## func [ChunkRawStateSnapshot](https://github.com/latticexyz/mud/blob/main/packages/services/pkg/snapshot/snapshot.go#L294)

```go
func ChunkRawStateSnapshot(rawStateSnapshot *pb.ECSStateSnapshot, chunkPercentage int) []*pb.ECSStateSnapshot
```

ChunkRawStateSnapshot splits a rawStateSnapshot ECSStateSnapshot in protobuf format into a list of ECSStateSnapshot's also in protobuf format. Each ECSStateSnapshot after chunking is chunkPercentage fraction size of the original snapshot.

## func [IsSnaphotAvailableLatest](https://github.com/latticexyz/mud/blob/main/packages/services/pkg/snapshot/snapshot.go#L44)

```go
func IsSnaphotAvailableLatest(worldAddress string) bool
```

## func [IsWorldAddressSnapshotAvailable](https://github.com/latticexyz/mud/blob/main/packages/services/pkg/snapshot/snapshot.go#L443)

```go
func IsWorldAddressSnapshotAvailable() bool
```

IsWorldAddressSnapshotAvailable returns if a snapshot of all indexed World addresses is available.

## func [PruneSnapshotOwnedByComponent](https://github.com/latticexyz/mud/blob/main/packages/services/pkg/snapshot/snapshot.go#L451)

```go
func PruneSnapshotOwnedByComponent(snapshot *pb.ECSStateSnapshot, pruneForAddress string) *pb.ECSStateSnapshot
```

PruneSnapshotOwnedByComponent prunes a given ECSStateSnapshot, given an address. This helps get rid of unnecessary state that a given address does not depend on in order to perform actions.

## func [RawReadStateSnapshotLatest](https://github.com/latticexyz/mud/blob/main/packages/services/pkg/snapshot/snapshot.go#L286)

```go
func RawReadStateSnapshotLatest(worldAddress string) *pb.ECSStateSnapshot
```

RawReadStateSnapshotLatest returns the latest ECS state snapshot in protobuf format.

## func [RawReadWorldAddressesSnapshot](https://github.com/latticexyz/mud/blob/main/packages/services/pkg/snapshot/snapshot.go#L437)

```go
func RawReadWorldAddressesSnapshot() *pb.Worlds
```

RawReadWorldAddressesSnapshot returns a snapshot of all indexed World addresses in protobuf format.

## func [Start](https://github.com/latticexyz/mud/blob/main/packages/services/pkg/snapshot/core.go#L37-L44)

```go
func Start(state ChainECSState, client *ethclient.Client, startBlock *big.Int, worldAddresses []common.Address, config *SnapshotServerConfig, logger *zap.Logger)
```

Start starts the process of processing data from an Ethereum client, reducing the ECS state, and taking intermittent snapshots.

## type [ChainECSState](https://github.com/latticexyz/mud/blob/main/packages/services/pkg/snapshot/state.go#L21)

ChainECSState is the full state of a chain, which is a mapping from all worlds to their ECSState.

```go
type ChainECSState = map[string]ECSState
```

### func [Sync](https://github.com/latticexyz/mud/blob/main/packages/services/pkg/snapshot/sync.go#L23)

```go
func Sync(client *ethclient.Client, fromBlock *big.Int, toBlock *big.Int, worldAddresses []common.Address, config *SnapshotServerConfig) ChainECSState
```

Sync performs an initial sync to the state of the chain from block number fromBlock to block number toBlock with an optional worldAddresses filter to filter the state.

If there is a snapshot available to load, uses that snapshot as the initial state and starts the sync up to the specified toBlock, otherwise starts with an empty ECS state and syncs everything while reducing the state.

Returns the entire ECS state once the sync is complete.

## type [ECSState](https://github.com/latticexyz/mud/blob/main/packages/services/pkg/snapshot/state.go#L18)

ECSState mimics a simple state machine, hence every transformation must return the updated state and there are no objects. This type represents an ECS state on the world.

```go
type ECSState = map[string]*sync.Map
```

### func [SnapshotToState](https://github.com/latticexyz/mud/blob/main/packages/services/pkg/snapshot/snapshot.go#L175)

```go
func SnapshotToState(stateSnapshot *pb.ECSStateSnapshot) ECSState
```

## type [SnapshotServerConfig](https://github.com/latticexyz/mud/blob/main/packages/services/pkg/snapshot/core.go#L17-L33)

```go
type SnapshotServerConfig struct {
    // The block number interval for how often to take regular snapshots.
    SnapshotBlockInterval int64
    // The number of blocks to fetch data for when performing an initial
    // sync. This is limited by the bandwidth limit of Geth for fetching logs, which is a hardcoded
    // constant.
    InitialSyncBlockBatchSize int64
    // The time to wait between calls to fetch batched log data when performing an initial sync.
    InitialSyncBlockBatchSyncTimeout time.Duration
    // The block number interval for how often to take intermediary
    // snapshots when performing an initial sync. This is useful in case the snapshot service
    // disconnects or fails while perfoming a lengthy initial sync.
    InitialSyncSnapshotInterval int64

    // Default to use when chunking snapshot to send snapshot in chunks over the wire.
    DefaultSnapshotChunkPercentage int
}
```

## type [SnapshotType](https://github.com/latticexyz/mud/blob/main/packages/services/pkg/snapshot/snapshot.go#L24)

A SnapshotType distinguishes between snapshot types if those are required.

```go
type SnapshotType int
```

```go
const (
    Latest        SnapshotType = iota // latest available snapshot
    BlockSpecific                     // snapshot at a specific block
    InitialSync                       // snapshot taken right after the service has performed a sync
)
```

Generated by [gomarkdoc](https://github.com/princjef/gomarkdoc)
