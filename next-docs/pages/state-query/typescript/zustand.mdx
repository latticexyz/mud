import { CollapseCode } from "../../../components/CollapseCode";

# Zustand

[Zustand](https://docs.pmnd.rs/zustand/getting-started/introduction) is a state management library that supports JavaScript and TypeScript.
You can see it in use in the [`react` template](https://github.com/latticexyz/mud/tree/main/templates/react).

## Zustand and React

Zustand is React native.
The way you use it is very similar to the way you'd use `useState`, except that the state you receive is bigger, it is auto-populated by MUD, and you change it through a `System` instead of using a function provided by the hook.

### Initialization

To initialize the synchronization you use [`syncToZustand`](https://github.com/latticexyz/mud/blob/main/packages/store-sync/src/zustand/syncToZustand.ts).

```ts copy
const { tables, useStore, latestBlock$, storedBlockLogs$, waitForTransaction } = await syncToZustand({
  config: mudConfig,
  address: networkConfig.worldAddress as Hex,
  publicClient,
  startBlock: BigInt(networkConfig.initialBlockNumber),
});
```

The most important fields returned by `syncToZustand` are:

- The `tables` variable, which contains the metadata (key schema, value schema, etc.) of the tables.
- The `useStore` [React hook](https://react.dev/reference/react/hooks) you can use to [read information from tables](https://github.com/pmndrs/zustand#selecting-multiple-state-slices).
  It can also be used [without React](https://github.com/pmndrs/zustand#readingwriting-state-and-reacting-to-changes-outside-of-components).

### Get all records

To get all the records in a specific table you can use this syntax:

```tsx copy
const records = useStore(state => Object.values(state.getRecords(tables.<table name>)))
```

The result is a list of records.
For every field that is part of the key each record contains a `key.<field name>` field.
For every field that is part of the value each record contains a `value.<field name>` field.

For example, if you look at [the `Systems` table](https://github.com/latticexyz/mud/blob/main/packages/world/mud.config.ts#L63-L72), you might get these records:

<CollapseCode>

```json showLineNumbers {1-2,28-36,62-70}
[
  {
    "id": "0x7462776f726c6400000000000000000053797374656d73000000000000000000:0x73790000000000000000000000000000636f7265000000000000000000000000",
    "table": {
      "keySchema": {
        "systemId": {
          "type": "bytes32",
          "internalType": "ResourceId"
        }
      },
      "valueSchema": {
        "system": {
          "type": "address",
          "internalType": "address"
        },
        "publicAccess": {
          "type": "bool",
          "internalType": "bool"
        }
      },
      "namespace": "world",
      "name": "Systems",
      "tableId": "0x7462776f726c6400000000000000000053797374656d73000000000000000000"
    },
    "keyTuple": ["0x73790000000000000000000000000000636f7265000000000000000000000000"],
    "key": {
      "systemId": "0x73790000000000000000000000000000636f7265000000000000000000000000"
    },
    "value": {
      "system": "0xD041DF1408B365897dA363b3b2100057514CC725",
      "publicAccess": true
    }
  },
  {
    "id": "0x7462776f726c6400000000000000000053797374656d73000000000000000000:0x737900000000000000000000000000005461736b7353797374656d0000000000",
    "table": {
      "keySchema": {
        "systemId": {
          "type": "bytes32",
          "internalType": "ResourceId"
        }
      },
      "valueSchema": {
        "system": {
          "type": "address",
          "internalType": "address"
        },
        "publicAccess": {
          "type": "bool",
          "internalType": "bool"
        }
      },
      "namespace": "world",
      "name": "Systems",
      "tableId": "0x7462776f726c6400000000000000000053797374656d73000000000000000000"
    },
    "keyTuple": ["0x737900000000000000000000000000005461736b7353797374656d0000000000"],
    "key": {
      "systemId": "0x737900000000000000000000000000005461736b7353797374656d0000000000"
    },
    "value": {
      "system": "0x29E2e167C27caab62666E2E88B4e3BEB579E351F",
      "publicAccess": true
    }
  }
]
```

</CollapseCode>

### Get a specific record

To get a specific record you can use `getRecord`.
For example, this code finds the record for the `systemId` that corresponds to `:TasksSystem`.

```ts copy
const key = {
  systemId: "0x737900000000000000000000000000005461736b7353797374656d0000000000",
};
const rec = useStore((state) => state.getRecord(tables.Systems, key));
```

For the result:

```json
{
  "id": "0x7462776f726c6400000000000000000053797374656d73000000000000000000:0x737900000000000000000000000000005461736b7353797374656d0000000000",
  "table": {
    "keySchema": {
      "systemId": {
        "type": "bytes32",
        "internalType": "ResourceId"
      }
    },
    "valueSchema": {
      "system": {
        "type": "address",
        "internalType": "address"
      },
      "publicAccess": {
        "type": "bool",
        "internalType": "bool"
      }
    },
    "namespace": "world",
    "name": "Systems",
    "tableId": "0x7462776f726c6400000000000000000053797374656d73000000000000000000"
  },
  "keyTuple": ["0x737900000000000000000000000000005461736b7353797374656d0000000000"],
  "key": {
    "systemId": "0x737900000000000000000000000000005461736b7353797374656d0000000000"
  },
  "value": {
    "system": "0x29E2e167C27caab62666E2E88B4e3BEB579E351F",
    "publicAccess": true
  }
}
```

If you just want the value, you can use `getValue`.

```ts copy
const key = {
  systemId: "0x737900000000000000000000000000005461736b7353797374656d0000000000",
};
const val = useStore((state) => state.getValue(tables.Systems, key));
```

For the result:

```json
{
  "system": "0x29E2e167C27caab62666E2E88B4e3BEB579E351F",
  "publicAccess": true
}
```
